---
title: "Universo Tidy"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
library(tidyverse)
knitr::opts_chunk$set(echo = FALSE)
```


## O que √© o Tidyverse?

O **tidyverse** √© um *ecossistema de pacotes em R* que compartilham uma **filosofia de design comum** e s√£o usados para **ci√™ncia de dados**. Ele foi criado por **Hadley Wickham** e colaboradores, com o objetivo de tornar a manipula√ß√£o, visualiza√ß√£o e modelagem de dados mais **consistente, leg√≠vel e eficiente**.

<div style="text-align: center;">
  <img src="images/HadleyWickham.jpg" alt="Hadley Wickham" width="300px">
</div>

### Caracter√≠sticas principais

- Usa **tibbles** (uma vers√£o moderna dos data frames) como estrutura central.
- Favorece uma **sintaxe funcional e encadeada**, geralmente com o operador **pipe (`%>%`)**.
- Promove dados organizados de forma **tidy**, ou seja:

> *Cada vari√°vel em uma coluna, cada observa√ß√£o em uma linha e cada valor em uma c√©lula.*

### üß† Curiosidade: O tidyverse tamb√©m segue o paradigma tidy

Isso significa que:
- As fun√ß√µes tendem a ter nomes **verbais** e consistentes (`filter()`, `mutate()`, `select()` etc.).
- O foco √© sempre **organizar, transformar e visualizar dados de forma clara**.

## Pacotes principais do tidyverse

```{r}
# Exibindo os principais pacotes do tidyverse em forma de tabela
tibble::tibble(
  Pacote = c("ggplot2", "dplyr", "tidyr", "readr", "tibble", "purrr", "stringr", "forcats"),
  Fun√ß√£o = c(
    "Visualiza√ß√£o de dados",
    "Manipula√ß√£o e transforma√ß√£o de dados",
    "Organiza√ß√£o e 'arruma√ß√£o' dos dados",
    "Leitura de arquivos retangulares (CSV, etc)",
    "Vers√£o moderna dos data frames",
    "Programa√ß√£o funcional com listas e vetores",
    "Manipula√ß√£o de strings",
    "Manipula√ß√£o de vari√°veis fator"
  )
)
```

### üß© Pacotes adicionais (n√£o carregados automaticamente)
        
Esses pacotes **fazem parte da fam√≠lia tidyverse**, mas **n√£o s√£o carregados automaticamente** com `library(tidyverse)`. S√£o usados em contextos mais espec√≠ficos:
        
| Pacote |Fun√ß√£o principal|
|----------------|---------------------------------------------------------------------|
| **lubridate**  | Manipula√ß√£o de datas e horas de forma intuitiva|
| **hms**| Representa√ß√£o de dura√ß√µes de tempo (horas, minutos e segundos)      |
        | **readxl**     | Leitura de arquivos do Excel (`.xls` e `.xlsx`)                     |
        | **writexl**    | Escrita de arquivos Excel (`.xlsx`) sem depender de Java            |
        | **haven**      | Leitura de arquivos de SPSS, Stata e SAS                            |
        | **xml2**       | Leitura e manipula√ß√£o de arquivos XML                               |
        | **rvest**      | Leitura de dados da web (web scraping)                              |
        | **httr**       | Realiza√ß√£o de requisi√ß√µes HTTP para APIs                            |
        | **jsonlite**   | Leitura e escrita de arquivos JSON                                  |
        | **modelr**     | Suporte a modelagem integrada a pipelines do tidyverse              |
        | **tidyverse**  | Metapacote que instala e carrega os principais pacotes do grupo     |
        
        ---

## O que s√£o *tibbles*?

Tibbles s√£o uma vers√£o **moderna e aprimorada** dos tradicionais `data.frames` do R. Eles fazem parte do pacote `{tibble}`, que est√° inclu√≠do no `{tidyverse}`.

### Por que usar tibbles?

Tibbles oferecem v√°rias **vantagens pr√°ticas** para an√°lise de dados:

- **Impress√£o amig√°vel**: ao mostrar os dados no console, exibem apenas as primeiras linhas e as colunas que cabem na tela.
- **Preservam os tipos de dados**: n√£o convertem strings automaticamente em fatores (como o `data.frame` faz por padr√£o).
- **Subconjuntos mais seguros**: acessar colunas inexistentes retorna erro em vez de `NULL` silenciosamente.
- **Integram-se bem com pipes (`%>%`) e fun√ß√µes do tidyverse.**


```{r}
# Criando um data.frame tradicional
df <- data.frame(
  nome = c("Ana", "Bruno"),
  idade = c(22, 25)
)

# Criando um tibble
tb <- tibble::tibble(
  nome = c("Ana", "Bruno"),
  idade = c(22, 25)
)
```


### Estrutura de um tibble

```{r}
str(df)
str(tb)
```

Para mostrar a diferen√ßa no comportamento de **impress√£o**, considere um conjunto de dados com muitas linhas e colunas:

```{r}
# Criando um data.frame grande
df_grande <- data.frame(
  id = 1:100,
  nome = paste("Pessoa", 1:100),
  idade = sample(18:80, 100, replace = TRUE),
  cidade = sample(c("Vi√ßosa", "Belo Horizonte", "S√£o Paulo", "Fortaleza"), 100, replace = TRUE),
  renda = rnorm(100, mean = 3000, sd = 800)
)

# Convertendo para tibble
tb_grande <- as_tibble(df_grande)
```

### Impress√£o do `data.frame`

```{r}
print(df_grande)
```

> ‚ùå A impress√£o do `data.frame` mostra **todas as 100 linhas**, o que pode deixar o console polu√≠do e dif√≠cil de ler.

### Impress√£o do `tibble`

```{r}
print(tb_grande)
```

## O que √© o operador **pipe** (`%>%`)?

O operador `**%>%**`, chamado de **pipe**, √© uma ferramenta poderosa que **encadeia opera√ß√µes** de forma sequencial, tornando o c√≥digo mais leg√≠vel e fluido. Ele √© fornecido pelo pacote `{magrittr}`, que faz parte do `{tidyverse}`.

---

### üí° Intui√ß√£o

Em vez de escrever v√°rias fun√ß√µes **uma dentro da outra**, com muitos par√™nteses, o `pipe` permite **escrever o processo passo a passo**, como em uma receita.

> üì¶ Pense no `pipe` como o **"ent√£o"**:  
> Pegue os dados ‚Üí ent√£o filtre ‚Üí ent√£o agrupe ‚Üí ent√£o resuma.

---

### üÜö Sem o `pipe`

```{r pipe1, exercise = TRUE}
# Sem usar o pipe
res <- summarise(
  group_by(
    filter(mtcars, mpg > 20),
    cyl
  ),
  media_hp = mean(hp)
)

res
```

---

### ‚úÖ Com o `pipe`

```{r pipe2, exercise = TRUE}
# Usando o pipe
res <- mtcars %>%
  filter(mpg > 20) %>%
  group_by(cyl) %>%
  summarise(media_hp = mean(hp))

res
```

> üîç Muito mais f√°cil de ler: "mtcars ‚Üí filtra os carros com mpg > 20 ‚Üí agrupa por n√∫mero de cilindros ‚Üí calcula a m√©dia de hp".

---

### üß† Curiosidade:

<p style="text-align: justify;">
O nome <code>magrittr</code> √© uma refer√™ncia ao artista surrealista <strong>Ren√© Magritte</strong>, famoso pela pintura "Ceci n‚Äôest pas une pipe" (Isto n√£o √© um cachimbo). O nome do pacote √© uma brincadeira conceitual com o operador <code>%>%</code>.
</p>

### üìå Dica importante

O `pipe` envia **o resultado da esquerda como primeiro argumento** da fun√ß√£o da direita. Isso s√≥ funciona bem se a fun√ß√£o da direita espera esse argumento como **primeiro par√¢metro**.

```{r pipe3, exercise = TRUE}
# Exemplo: usar o objeto como segundo argumento
rnorm(5, mean = 10)     # sem pipe

5 %>% rnorm(mean = 10)  # com pipe
```

## O que √© o formato **tidy**?

O termo **"tidy"** significa **organizado**. No contexto da ci√™ncia de dados com R, dados tidy seguem uma estrutura **padronizada** que facilita a an√°lise, visualiza√ß√£o e modelagem.

### üìê Defini√ß√£o de dados tidy

Segundo Hadley Wickham:

> Dados tidy s√£o aqueles onde:
>
> - Cada **vari√°vel** est√° em uma **coluna**  
> - Cada **observa√ß√£o** est√° em uma **linha**  
> - Cada **valor** est√° em uma **c√©lula**

---

### üß± Estrutura tidy ‚Äî Exemplo

Vamos considerar uma tabela com notas de alunos em diferentes disciplinas:

#### ‚ùå Dados bagun√ßados (wide format):

| aluno | mat | port |
|-------|-----|------|
| Ana   | 90  | 80   |
| Bruno | 70  | 85   |

#### ‚úÖ Dados tidy (long format):

| aluno | disciplina | nota |
|-------|------------|------|
| Ana   | mat        | 90   |
| Ana   | port       | 80   |
| Bruno | mat        | 70   |
| Bruno | port       | 85   |

---

### ‚ú® Vantagens dos dados tidy

- Permite usar fun√ß√µes do `{dplyr}`, `{ggplot2}`, `{tidyr}`, etc.
- Facilita agrupamentos, somas, m√©dias e transforma√ß√µes.
- √â o formato preferido para an√°lise e visualiza√ß√£o de dados no `tidyverse`.

---

### Transformando dados wide ‚Üí tidy com `pivot_longer()`

```{r pivot, exercise = TRUE}
# Exemplo com dados wide
dados_wide <- tibble::tibble(
  aluno = c("Ana", "Bruno"),
  mat = c(90, 70),
  port = c(80, 85)
)

# Convertendo para formato tidy (long)
dados_tidy <- dados_wide %>%
  tidyr::pivot_longer(
    cols = c(mat, port),
    names_to = "disciplina",
    values_to = "nota"
  )

dados_tidy
```

```{r}
# Exemplo com dados wide
dados_wide <- tibble::tibble(
  aluno = c("Ana", "Bruno"),
  mat = c(90, 70),
  port = c(80, 85)
)

# Convertendo para formato tidy (long)
dados_tidy <- dados_wide %>%
  tidyr::pivot_longer(
    cols = c(mat, port),
    names_to = "disciplina",
    values_to = "nota"
  )
DT::datatable(dados_tidy)
```





